#!/usr/bin/env bash

usage()
{
    echo "Usage: ${0##*/} {start|stop|restart} {integration|qa|staging|production}"
    exit 1
}
# absolute path to this script directory (without script name)
SCRIPT_PATH="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd $SCRIPT_PATH

#load RVM and .rvmrc file
[[ -s "/usr/local/rvm/scripts/rvm" ]] && source "/usr/local/rvm/scripts/rvm"
[[ -s "./.rvmrc" ]] && source "./.rvmrc"
set -x
set -e

LOCATION=/live/apps/nsidc-open-search-solr
export RUBY_BIN=/opt/ruby19-local/bin/
export GEM_HOME=$LOCATION/gem
export GEM_PATH=$GEM_HOME/bin
export PATH=$GEM_HOME:$GEM_PATH:$PATH
export PATH=/opt/jdk/bin/:$PATH   #Adding Java to the path

#gem install bundler
#which bundle
#bundle install

if [[ -z "$2" ]]
then
  env="integration"
elif [[ "$2" -eq "integration" || "$2" -eq "qa" || "$2" -eq "staging"  || "$2" -eq "production" ]]
then
  env="$2"
else
  echo "|$2|"
  echo "Invalid environment $2 specified, please try again"
  usage
fi

if [ "$1" -eq "restart" ]
then
   bundle exec rake stop_solr[$env]
   bundle exec rake start_solr[$env]
elif [[ "$1" -eq "stop" ]]
then
   bundle exec rake stop_solr[$env]
elif [[ "$1" -eq "start" ]]
then
   bundle exec rake start_solr[$env]
elif [[ "$1" -eq "environment" ]]
then
  echo "Environment setup complete"
else
   usage
fi


